
{% extends 'base.html' %}
{% load static %}

{% block content %}
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
        <a class="navbar-brand" href="{% url 'home' %}">Plant Shop</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'home' %}">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'products_module:products' %}">Products</a>
                </li>
                <!-- ...existing code... -->
            </ul>
        </div>
    </div>
</nav>

<div class="container-fluid py-5">
    <!-- Filter Section -->
    <div class="row mb-4">
        <div class="col-lg-3">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title mb-3">Filters</h5>
                    <div class="mb-3">
                        <label class="form-label">Category</label>
                        <select class="form-select" id="categoryFilter">
                            <option value="">All Categories</option>
                            <option value="indoor">Indoor Plants</option>
                            <option value="outdoor">Outdoor Plants</option>
                            <option value="succulents">Succulents</option>
                            <option value="herbs">Herbs</option>
                            <option value="trees">Trees</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Price Range</label>
                        <div class="d-flex gap-2">
                            <input type="number" class="form-control" id="minPrice" placeholder="Min">
                            <input type="number" class="form-control" id="maxPrice" placeholder="Max">
                        </div>
                    </div>
                    <button class="btn btn-primary w-100" id="applyFilters">Apply Filters</button>
                </div>
            </div>
        </div>
        
        <!-- Products Grid -->
        <div class="col-lg-9">
            <div class="row g-4" id="productsContainer">
                <!-- Products will be loaded here dynamically -->
            </div>
        </div>
    </div>
</div>

<!-- Product Template -->
<template id="productTemplate">
    <div class="col-md-4">
        <div class="card h-100 product-card" data-aos="fade-up">
            <img src="" class="card-img-top product-image" alt="">
            <div class="card-body">
                <h5 class="card-title product-name"></h5>
                <p class="card-text product-description"></p>
                <div class="d-flex justify-content-between align-items-center">
                    <span class="h5 mb-0 product-price"></span>
                    <button class="btn btn-success btn-sm add-to-cart">
                        <i class="bi bi-cart-plus"></i> Add to Cart
                    </button>
                </div>
            </div>
        </div>
    </div>
</template>

<style>
.product-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.1);
}

.product-image {
    height: 200px;
    object-fit: cover;
}

.add-to-cart {
    opacity: 0;
    transform: translateY(10px);
    transition: all 0.3s ease;
}

.product-card:hover .add-to-cart {
    opacity: 1;
    transform: translateY(0);
}
</style>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const token = localStorage.getItem('access_token');
    const apiClient = axios.create({
        baseURL: '/api',
        headers: token ? {
            'Authorization': `Bearer ${token}`
        } : {}
    });

    const productsContainer = document.getElementById('productsContainer');
    const productTemplate = document.getElementById('productTemplate');
    
    function loadProducts(filters = {}) {
        apiClient.get('/products/', { params: filters })
            .then(response => {
                productsContainer.innerHTML = '';
                response.data.results.forEach(product => {
                    const template = productTemplate.content.cloneNode(true);
                    const card = template.querySelector('.product-card');
                    
                    card.querySelector('.product-image').src = product.image;
                    card.querySelector('.product-name').textContent = product.name;
                    card.querySelector('.product-description').textContent = product.description;
                    card.querySelector('.product-price').textContent = `$${product.price}`;
                    
                    card.querySelector('.add-to-cart').addEventListener('click', () => {
                        addToCart(product.id);
                    });
                    
                    productsContainer.appendChild(template);
                });
                AOS.refresh();
            })
            .catch(error => {
                if (error.response?.status === 401) {
                    // Handle unauthorized access
                    console.error('Authentication required');
                }
                console.error('Error loading products:', error);
            });
    }
    
    document.getElementById('applyFilters').addEventListener('click', () => {
        const filters = {
            category: document.getElementById('categoryFilter').value,
            min_price: document.getElementById('minPrice').value,
            max_price: document.getElementById('maxPrice').value,
        };
        loadProducts(filters);
    });
    
    function addToCart(productId) {
        if (!token) {
            window.location.href = "{% url 'account_module:login' %}";
            return;
        }
        
        apiClient.post(`/products/${productId}/add_to_cart/`)
            .then(response => {
                // Handle success
                console.log('Product added to cart');
            })
            .catch(error => console.error('Error adding to cart:', error));
    }
    
    // Initial load
    loadProducts();
});
</script>
{% endblock %}